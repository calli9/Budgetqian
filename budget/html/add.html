<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta http-equiv="X-UA-Computer" content="ie=edge">

    <link rel="stylesheet" href="../css/style.css">
    <title>小钱钱 | 财务追踪管理</title>

</head>

<body>
    <header class="header">
        <h1>添加交易</h1>
    </header>
    <main class="main padding-nor" style="margin-bottom: 2rem;">
        <section class="card padding-nor shadow-Littledark">
            <div class="grid-half" id="top">
                <button class="btn-active-red" style="margin-top: 0;" id="out">
                    - 支出
                </button>
                <button style="margin-top: 0;" id="in">
                    + 收入
                </button>

            </div>
            <form action="home.html">
                <div>
                    <label>金额</label>
                    <div>
                        <div>
                            <input type="number" step="0.01" min="0.01" placeholder="￥ 0.00">
                        </div>
                    </div>
                </div>
                <div>
                    <label>类别</label>
                    <div id="record" class="grid"></div>
                </div>
                <div>
                    <label>日期</label>
                    <input type="datetime-local" value="2025-09-16">
                </div>
                <div>
                    <label>备注(可选)</label>
                    <textarea placeholder="添加备注信息..." rows="3" class="form-textarea"></textarea>
                </div>
                <div class="grid-half" id="buttom">
                    <button style="border:1px solid #d1d5db;margin-bottom: 0;">
                        <a href="home.html" class="text-a" style=" color: #000;">取消</a>
                    </button>
                    <button type="submit" class="bgcolor-blue" style="margin-bottom: 0;" id="add">确定</button>
                </div>
            </form>
        </section>
    </main>
    <script src="../js/nav.js"></script>
    <script>
        const categoryOut = [
            {
                xlink: "../icomoon/all.svg#spoon-knife",
                span: "餐饮"
            }, {
                xlink: "../icomoon/all.svg#shopping-bag",
                span: "购物"
            },
            {
                xlink: "../icomoon/all.svg#automobile",
                span: "交通"
            },
            {
                xlink: "../icomoon/all.svg#home3",
                span: "住房"
            },
            {
                xlink: "../icomoon/all.svg#film",
                span: "娱乐"
            },
            {
                xlink: "../icomoon/all.svg#flickr",
                span: "其他"
            }]

        const categoryIn = [
            {
                xlink: "../icomoon/all.svg#credit-card",
                span: "工资"
            },
            {
                xlink: "../icomoon/all.svg#coin-yen",
                span: "投资"
            },
            {
                xlink: "../icomoon/all.svg#briefcase",
                span: "兼职"
            },
            {
                xlink: "../icomoon/all.svg#flickr",
                span: "其他"
            }
        ]

        const color = ["orange", "red", "blue", "purple", "pink", "gray"]

        const label = document.querySelectorAll("label")
        const Bbutton = document.querySelectorAll("#buttom button")
        const Tbutton = document.querySelectorAll("#top button")
        const input = document.querySelectorAll("input")

        //action
        label.forEach(item => item.classList.add("font-sm", "font-big", "black"))
        Bbutton.forEach(item => item.classList.add("form-button", "font-big", "font-fat", "bgcolor-whitelight"))
        Tbutton.forEach(item => item.classList.add("form-button__top", "font-big", "font-fat", "btn-normal-color"))
        input.forEach(item => item.classList.add("form-input"))

        const record = document.querySelector('#record');
        render = (arr, cls) => {
            record.innerHTML = arr.map((item, i) =>
                `<div>
                    <button class="${cls} not-focus" type="button" style="background:transparent">
                        <div class="padding-sm ${cls.includes('form-button__gridRed') ? `bgcolor-Littlered` : 'bgcolor-Littlegreen'}" style="border-radius:50%">
                            <svg class="svg-sm ${cls.includes('form-button__gridRed') ? `color-${color[i]}` : 'color-green'}">
                                <use href="${item.xlink}"></use>
                            </svg>
                        </div>
                        <span class="black">${item.span}</span>
                    </button>
                </div>
        `).join('')
        }

        //class
        const outBtn = document.querySelector('#out')
        const inBtn = document.querySelector('#in')

        function clearHighlight() {
            document.querySelectorAll('#record button').forEach(b => {
                b.classList.remove('focus-red', 'focus-green');
            });
        }

        function bindCategoryClick() {
            const reds = document.querySelectorAll('.form-button__gridRed');
            const greens = document.querySelectorAll('.form-button__gridGreen');

            reds.forEach(b => b.addEventListener('click', function () {
                clearHighlight();
                this.classList.add('focus-red');
            }));

            greens.forEach(b => b.addEventListener('click', function () {
                clearHighlight();
                this.classList.add('focus-green');
            }));
        }

        render(categoryOut, 'form-button__gridRed');
        bindCategoryClick();

        let flag = 0;

        outBtn.addEventListener('click', function () {
            outBtn.classList.add('btn-active-red')
            inBtn.classList.remove('btn-active-green')
            render(categoryOut, 'form-button__gridRed');
            bindCategoryClick();

            flag = 0;
        });
        inBtn.addEventListener('click', function () {
            inBtn.classList.add('btn-active-green')
            outBtn.classList.remove('btn-active-red')
            render(categoryIn, 'form-button__gridGreen');
            bindCategoryClick();

            flag = 1;
        });

        //add
        document.querySelector('form').addEventListener('submit', function (e) {
            e.preventDefault();

            const selectedButton = document.querySelector('#record button.focus-red, #record button.focus-green');
            if (!selectedButton) {
                return;
            }

            const svgUse = selectedButton.querySelector('use');
            const spanText = selectedButton.querySelector('span').textContent;

            const message = {
                xlink: svgUse.getAttribute('href'),
                h3: spanText,
                time: document.querySelector("input[type='datetime-local']").value,
                p: document.querySelector("textarea").value,
                num: parseFloat(document.querySelector("input[type='number']").value),
                revenue: flag
            };

            let records = JSON.parse(localStorage.getItem('user-list')) || [];
            records.push(message);
            localStorage.setItem('user-list', JSON.stringify(records));

            location.href = 'home.html';
        });



    </script>
</body>

</html>